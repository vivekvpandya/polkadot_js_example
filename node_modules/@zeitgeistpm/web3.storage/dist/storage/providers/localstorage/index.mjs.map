{"version":3,"file":"index.mjs","sources":["../../../../src/storage/providers/localstorage/index.ts"],"sourcesContent":["import { Codec } from '@zeitgeistpm/utility/dist/codec'\nimport { JsonCodec } from '@zeitgeistpm/utility/dist/codec'\nimport { throws } from '@zeitgeistpm/utility/dist/error'\nimport { from } from '@zeitgeistpm/utility/dist/option'\nimport * as Te from '@zeitgeistpm/utility/dist/taskeither'\nimport { Storage } from '../..'\n\n/**\n *\n * Create a MetadataStorage object that can store data to localstorage.\n * Only meant for local development on dev nodes with ephemeral block storage.\n *\n * @generic T - type of metadata\n */\nexport const storage = <T extends object>(\n  codec: Codec<string, T> = JsonCodec<T>(),\n): Storage<T, string> => {\n  return {\n    put: Te.from(async data => {\n      const content = codec.decode(data).unrightOr(throws)\n\n      const buffer = await crypto.subtle.digest(\n        'SHA-256',\n        new TextEncoder().encode(content),\n      )\n\n      const hash = Array.prototype.map\n        .call(new Uint8Array(buffer), x => ('00' + x.toString(16)).slice(-2))\n        .join('')\n\n      localStorage.setItem(hash, content)\n\n      return hash\n    }),\n\n    get: Te.from(async hash => {\n      const data = from<string>(localStorage.getItem(hash)).map(codec.encode)\n      return data.bind(d => d.unright())\n    }),\n\n    del: Te.from(async hash => localStorage.removeItem(hash)),\n  }\n}\n"],"names":[],"mappings":";;;;;AAOA;;;;;;AAMG;MACU,OAAO,GAAG,CACrB,KAA0B,GAAA,SAAS,EAAK,KAClB;IACtB,OAAO;QACL,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,OAAM,IAAI,KAAG;AACxB,YAAA,MAAM,OAAO,GAAG,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAA;YAEpD,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,MAAM,CACvC,SAAS,EACT,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,CAClC,CAAA;AAED,YAAA,MAAM,IAAI,GAAG,KAAK,CAAC,SAAS,CAAC,GAAG;iBAC7B,IAAI,CAAC,IAAI,UAAU,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;iBACpE,IAAI,CAAC,EAAE,CAAC,CAAA;AAEX,YAAA,YAAY,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA;AAEnC,YAAA,OAAO,IAAI,CAAA;AACb,SAAC,CAAC;QAEF,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,OAAM,IAAI,KAAG;AACxB,YAAA,MAAM,IAAI,GAAG,IAAI,CAAS,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;AACvE,YAAA,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,CAAC,CAAA;AACpC,SAAC,CAAC;AAEF,QAAA,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,OAAM,IAAI,KAAI,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;KAC1D,CAAA;AACH;;;;"}